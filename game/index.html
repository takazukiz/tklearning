<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>九九穴埋めゲーム</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            color: #333;
            padding: 20px;
        }

        h1 {
            color: #2c3e50;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        select, button {
            padding: 8px 16px;
            font-size: 16px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            font-weight: bold;
        }

        button:hover {
            background-color: #2980b9;
        }

        #timer {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #e67e22;
        }

        .table-container {
            display: flex;
            justify-content: center;
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid #bdc3c7;
            width: 50px;
            height: 50px;
            text-align: center;
            vertical-align: middle;
            font-size: 18px;
        }

        /* ヘッダー（1-9の段表示） */
        th {
            background-color: #34495e;
            color: white;
        }
        
        /* 左上の角 */
        th.corner {
            background-color: #2c3e50;
        }

        /* 入力エリア */
        input[type="number"] {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 18px;
            background-color: #fffbe6; /* 薄い黄色 */
            outline: none;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* 正解・不正解のスタイル */
        .correct {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }

        .wrong {
            background-color: #f8d7da !important;
            color: #721c24;
        }

        #message {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            height: 30px;
            color: #27ae60;
        }
    </style>
</head>
<body>

    <h1>九九穴埋めゲーム</h1>

    <div class="controls">
        <label for="difficulty">難易度:</label>
        <select id="difficulty">
            <option value="10">初級 (少し隠す)</option>
            <option value="40">中級 (半分くらい)</option>
            <option value="70">上級 (たくさん)</option>
            <option value="100">暗記マスター (全部入力)</option>
        </select>
        <button onclick="startGame()">ゲームスタート</button>
    </div>

    <div id="timer">Time: 0.0s</div>
    <div id="message"></div>

    <div class="table-container">
        <table id="kukuTable">
            <!-- JavaScriptでここに表を生成します -->
        </table>
    </div>

    <script>
        let timerInterval;
        let startTime;
        let totalInputs = 0;
        let correctCount = 0;

        // ゲーム開始関数
        function startGame() {
            const table = document.getElementById('kukuTable');
            const difficulty = document.getElementById('difficulty').value;
            const messageEl = document.getElementById('message');
            
            // リセット
            table.innerHTML = '';
            messageEl.textContent = '';
            clearInterval(timerInterval);
            correctCount = 0;
            totalInputs = 0;

            // ヘッダー行の作成 (× 1 2 3 ... 9)
            const headerRow = document.createElement('tr');
            headerRow.appendChild(createHeaderCell('×', 'corner')); // 左上
            for (let i = 1; i <= 9; i++) {
                headerRow.appendChild(createHeaderCell(i));
            }
            table.appendChild(headerRow);

            // データ行の作成
            for (let row = 1; row <= 9; row++) {
                const tr = document.createElement('tr');
                
                // 左側のヘッダー (1 2 3 ... 9)
                tr.appendChild(createHeaderCell(row));

                for (let col = 1; col <= 9; col++) {
                    const ans = row * col;
                    const td = document.createElement('td');
                    
                    // 難易度（確率）に応じて穴埋めにするか数字を表示するか決める
                    const isHidden = Math.random() * 100 < difficulty;

                    if (isHidden) {
                        // 入力欄を作る
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.dataset.answer = ans; // 正解をデータ属性に持たせる
                        
                        // 入力時のイベントリスナー
                        input.addEventListener('input', checkInput);
                        
                        td.appendChild(input);
                        totalInputs++;
                    } else {
                        // 数字をそのまま表示
                        td.textContent = ans;
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }

            // タイマー開始
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 100);
            
            // 初級などで運悪く全部表示されてしまった場合の即終了防止
            if (totalInputs === 0) {
                messageEl.textContent = "全部表示されちゃった！もう一度スタートしてね。";
                clearInterval(timerInterval);
            }
        }

        // ヘッダーセル作成用ヘルパー
        function createHeaderCell(text, className = '') {
            const th = document.createElement('th');
            th.textContent = text;
            if (className) th.className = className;
            return th;
        }

        // 入力チェック関数
        function checkInput(e) {
            const input = e.target;
            const val = parseInt(input.value);
            const ans = parseInt(input.dataset.answer);

            if (isNaN(val)) {
                input.className = '';
                return;
            }

            if (val === ans) {
                if (!input.classList.contains('correct')) {
                    input.className = 'correct';
                    input.readOnly = true; // 正解したら変更不可にする
                    correctCount++;
                    
                    // 次の入力欄へフォーカス移動（簡易的）
                    moveFocus(input);

                    checkWin();
                }
            } else {
                input.className = 'wrong';
            }
        }

        // 全問正解チェック
        function checkWin() {
            if (correctCount === totalInputs) {
                clearInterval(timerInterval);
                const time = ((Date.now() - startTime) / 1000).toFixed(1);
                document.getElementById('message').textContent = `クリア！ 記録: ${time}秒`;
            }
        }

        // タイマー更新
        function updateTimer() {
            const time = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer').textContent = `Time: ${time}s`;
        }
        
        // Tabキーのような挙動で次の空欄へ移動する（UX向上）
        function moveFocus(currentInput) {
            const inputs = Array.from(document.querySelectorAll('input[type="number"]'));
            const index = inputs.indexOf(currentInput);
            if (index > -1 && index < inputs.length - 1) {
                // まだ正解していない次のinputを探す
                for(let i = index + 1; i < inputs.length; i++) {
                    if(!inputs[i].readOnly) {
                        inputs[i].focus();
                        break;
                    }
                }
            }
        }

        // 初期表示
        window.onload = function() {
            document.getElementById('message').textContent = "難易度を選んでスタートしてね！";
        };
    </script>
</body>
</html>